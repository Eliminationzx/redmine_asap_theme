<div class="bg-white shadow container mx-auto">
  <%= form_tag({}, :data => {:cm_url => issues_context_menu_path}) do -%>
    <%= hidden_field_tag 'back_url', url_for(:params => request.query_parameters), :id => nil %>
    <ul class="cal  w-full flex">
      <li scope="col" title="<%= l(:label_week) %>" class="calhead week-number p-2 border-r h-10 w-16 xl:text-sm text-xs"></li>
      <% 7.times do |i| %>
        <li scope="col" class="calhead font-medium text-center p-2 border-r h-10 xl:w-40 lg:w-30 md:w-30 sm:w-20 w-12 xl:text-sm text-xs"><%= day_name((calendar.first_wday + i) % 7) %></li>
      <% end %>
    </ul>

      <% calendar.format_month.each_slice(7) do |week| %>
      <ul class="cal  w-full flex flex-wrap">
        <li class='week-number bg-gray-50 text-xs text-gray-500 text-center border p-1 h-40 w-16 overflow-auto transition cursor-pointer duration-500 ease hover:bg-gray-300'>
          <span class="label-week"><%= l(:label_week) %></span> <%= calendar.week_number week.first %>
        </li>
        <% week.each do |day| %>
        <li class="<%= calendar.day_css_classes day %> calbody border p-1 h-40 xl:w-40 lg:w-30 md:w-30 sm:w-20 w-12 overflow-auto transition cursor-pointer duration-500 ease hover:bg-gray-300">
          <p class="day-num text-right text-xs text-gray-500"><%= day.day %>
            <span class="abbr-day">(<%= abbr_day_name(day.cwday) %>)</span>
          </p>
          <% calendar.events_on(day).each do |i| %>
            <% if i.is_a? Issue %>
              <%= tag.div class: [ i.css_classes, 'tooltip hascontextmenu', starting: day == i.start_date, ending: day == i.due_date] do %>
                <%= "#{i.project} -" unless @project && @project == i.project %>
                <%= link_to_issue i, :truncate => 30 %>
                <span class="tip"><%= render_issue_tooltip i %></span>
                <%= check_box_tag 'ids[]', i.id, false, :style => 'display:none;', :id => nil %>
              <% end %>
            <% else %>
              <span class="icon icon-package">
                <%= "#{i.project} -" unless @project && @project == i.project %>
                <%= link_to_version i %>
              </span>
            <% end %>
          <% end %>
        </li>
        <% end %>
      </ul>
      <% end %>

  <% end %>
</div>
<%= context_menu %>
