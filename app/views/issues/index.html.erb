<div data-controller="issues">
  <div class="w-full flex">
    <div class="ml-auto flex">
      <div data-action="click->issues#toggle" class="text-gray-900 cursor-pointer flex items-center bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z" />
        </svg>
        <span><%= l(:label_filters) %></span>
      </div>
      <% if User.current.allowed_to?(:add_issues, @project, :global => true) && (@project.nil? || Issue.allowed_target_trackers(@project).any?) %>
        <%= link_to  _new_project_issue_path(@project), :class => 'text-white flex bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800' do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
          </svg>
          <div><%= l(:label_issue_new) %></div>
        <% end %>
      <% end %>
      <%= actions_dropdown do %>
        <% if @project %>
          <%= link_to l(:field_summary), project_issues_report_path(@project), :class => 'icon icon-stats' %>
        <% end %>

        <% if User.current.allowed_to?(:import_issues, @project, :global => true) %>
          <%= link_to l(:button_import), new_issues_import_path(:project_id => @project), :class => 'icon icon-import' %>
        <% end %>

        <%= link_to_if_authorized l(:label_settings),
                  {:controller => 'projects', :action => 'settings', :id => @project, :tab => 'issues'},
                  :class => 'icon icon-settings' if User.current.allowed_to?(:edit_project, @project) %>
      <% end %>
    </div>
  </div>
  <!--
  <h2><%= @query.new_record? ? l(:label_issue_plural) : @query.name %></h2>
  -->
  <div data-issues-target="filters" class="shadow my-2 p-4 hidden">
    <% html_title(@query.new_record? ? l(:label_issue_plural) : @query.name) %>

    <%= form_tag(_project_issues_path(@project), :method => :get, :id => 'query_form') do %>
      <%= render :partial => 'queries/query_form' %>
    <% end %>
  </div>

  <% if @query.valid? %>
  <% if @issues.empty? %>
  <p class="nodata"><%= l(:label_no_data) %></p>
  <% else %>
  <%= render_query_totals(@query) %>
  <div class="my-8">
    <%= render :partial => 'issues/list', :locals => {:issues => @issues, :query => @query} %>
  </div>
  <span class="pagination"><%= pagination_links_full @issue_pages, @issue_count %></span>
  <% end %>

  <% other_formats_links do |f| %>
    <%= f.link_to_with_query_parameters 'Atom', :key => User.current.atom_key %>
    <%= f.link_to_with_query_parameters 'CSV', {}, :onclick => "showModal('csv-export-options', '350px'); return false;" %>
    <%= f.link_to_with_query_parameters 'PDF' %>
  <% end %>

  <div id="csv-export-options" style="display:none;">
    <h3 class="title"><%= l(:label_export_options, :export_format => 'CSV') %></h3>
    <%= form_tag(_project_issues_path(@project, :format => 'csv'), :method => :get, :id => 'csv-export-form') do %>
    <%= query_as_hidden_field_tags(@query) %>
    <p>
      <label><%= radio_button_tag 'c[]', '', true %> <%= l(:description_selected_columns) %></label><br />
      <label><%= radio_button_tag 'c[]', 'all_inline' %> <%= l(:description_all_columns) %></label>
    </p>
    <% if @query.available_block_columns.any? %>
      <fieldset id="csv-export-block-columns">
        <legend>
          <%= toggle_checkboxes_link('#csv-export-block-columns input[type=checkbox]') %>
        </legend>
        <% @query.available_block_columns.each do |column| %>
          <label><%= check_box_tag 'c[]', column.name, @query.has_column?(column), :id => nil %> <%= column.caption %></label>
        <% end %>
      </fieldset>
    <% end %>
    <%= export_csv_encoding_select_tag %>
    <% if @issue_count > Setting.issues_export_limit.to_i %>
    <p class="icon icon-warning">
      <%= l(:setting_issues_export_limit) %>: <%= Setting.issues_export_limit.to_i %>
    </p>
    <% end %>
    <p class="buttons">
      <%= submit_tag l(:button_export), :name => nil, :onclick => "hideModal(this);", :data => { :disable_with => false } %>
      <%= link_to_function l(:button_cancel), "hideModal(this);" %>
    </p>
    <% end %>
  </div>

  <% end %>
  <%= call_hook(:view_issues_index_bottom, { :issues => @issues, :project => @project, :query => @query }) %>

  <% content_for :sidebar do %>
      <%= render :partial => 'issues/sidebar' %>
  <% end %>

  <% content_for :header_tags do %>
      <%= auto_discovery_link_tag(:atom,
                                  {:query_id => @query, :format => 'atom',
                                  :page => nil, :key => User.current.atom_key},
                                  :title => l(:label_issue_plural)) %>
      <%= auto_discovery_link_tag(:atom,
                                  {:controller => 'journals', :action => 'index',
                                  :query_id => @query, :format => 'atom',
                                  :page => nil, :key => User.current.atom_key},
                                  :title => l(:label_changes_details)) %>
  <% end %>

  <%= context_menu %>
</div>